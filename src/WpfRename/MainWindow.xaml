<ui:FluentWindow x:Class="WpfRename.MainWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:local="clr-namespace:WpfRename"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 xmlns:converters="clr-namespace:WpfRename.Converters"
                 mc:Ignorable="d"
                 Title="WpfRename"
                 Height="700"
                 Width="1000"
                 MinHeight="500"
                 MinWidth="800"
                 WindowStartupLocation="CenterScreen">

    <ui:FluentWindow.Resources>
        <converters:NullToBoolConverter x:Key="NullToBoolConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
    </ui:FluentWindow.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <!-- 검색/치환 입력 영역 -->
            <RowDefinition Height="Auto" />
            <!-- 옵션 체크박스 영역 -->
            <RowDefinition Height="Auto" />
            <!-- 간격 -->
            <RowDefinition Height="16" />
            <!-- 파일 목록 DataGrid -->
            <RowDefinition Height="*" />
            <!-- 간격 -->
            <RowDefinition Height="16" />
            <!-- 상태바 및 버튼 -->
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 프리셋 및 검색/치환 입력 영역 -->
        <Grid Grid.Row="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="8" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 프리셋 영역 -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="200" />
                    <ColumnDefinition Width="8" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="프리셋:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0" />

                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding Presets}"
                          SelectedItem="{Binding SelectedPreset}"
                          DisplayMemberPath="Name">
                    <ComboBox.ItemContainerStyle>
                        <Style TargetType="ComboBoxItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        </Style>
                    </ComboBox.ItemContainerStyle>
                </ComboBox>

                <ui:Button Grid.Column="3"
                           Content="저장"
                           Icon="{ui:SymbolIcon Save24}"
                           Appearance="Secondary"
                           Margin="0,0,8,0"
                           Click="OnSavePresetClick" />

                <ui:Button Grid.Column="4"
                           Content="삭제"
                           Icon="{ui:SymbolIcon Delete24}"
                           Appearance="Secondary"
                           Command="{Binding DeletePresetCommand}"
                           CommandParameter="{Binding SelectedPreset}" />
            </Grid>

            <!-- 검색/치환 입력 -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="16" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="검색:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0" />

                <ui:TextBox Grid.Column="1"
                            PlaceholderText="검색할 텍스트 입력"
                            ClearButtonEnabled="True"
                            Text="{Binding SearchPattern, UpdateSourceTrigger=PropertyChanged}" />

                <TextBlock Grid.Column="3"
                           Text="치환:"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0" />

                <ui:TextBox Grid.Column="4"
                            PlaceholderText="치환할 텍스트 입력"
                            ClearButtonEnabled="True"
                            Text="{Binding ReplacePattern, UpdateSourceTrigger=PropertyChanged}">
                    <ui:TextBox.ToolTip>
                        <ToolTip>
                            <StackPanel MaxWidth="400">
                                <TextBlock FontWeight="Bold" Margin="0,0,0,8">사용 가능한 변수:</TextBlock>
                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,4">
                                    <Run FontWeight="SemiBold">열거형:</Run>
                                    <LineBreak />
                                    • ${count} - 순번 (001, 002, ...)
                                    <LineBreak />
                                    • ${count:start=10} - 시작 번호 지정
                                    <LineBreak />
                                    • ${count:step=5} - 증가값 지정
                                    <LineBreak />
                                    • ${count:digits=4} - 자릿수 지정
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap">
                                    <Run FontWeight="SemiBold">날짜/시간:</Run>
                                    <LineBreak />
                                    • ${now} - 현재 날짜/시간
                                    <LineBreak />
                                    • ${now:yyyy-MM-dd} - 형식 지정
                                    <LineBreak />
                                    • ${created} - 파일 생성일
                                    <LineBreak />
                                    • ${modified} - 파일 수정일
                                </TextBlock>
                            </StackPanel>
                        </ToolTip>
                    </ui:TextBox.ToolTip>
                </ui:TextBox>
            </Grid>
        </Grid>

        <!-- 옵션 체크박스 영역 -->
        <Grid Grid.Row="1"
              Margin="0,12,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0"
                        Orientation="Horizontal">
                <CheckBox Content="정규식 사용"
                          Margin="0,0,16,0"
                          IsChecked="{Binding UseRegex}" />
                <CheckBox Content="대소문자 구분"
                          Margin="0,0,16,0"
                          IsChecked="{Binding CaseSensitive}" />
                <ComboBox Width="150"
                          Margin="0,0,16,0"
                          SelectedIndex="{Binding CaseTransformIndex}">
                    <ComboBoxItem Content="변환 안 함" />
                    <ComboBoxItem Content="모두 소문자" />
                    <ComboBoxItem Content="모두 대문자" />
                    <ComboBoxItem Content="Title Case" />
                </ComboBox>
            </StackPanel>

            <!-- 정규식 오류 메시지 -->
            <ui:InfoBar Grid.Row="1"
                        Margin="0,8,0,0"
                        Severity="Error"
                        IsOpen="{Binding RegexError, Converter={StaticResource NullToBoolConverter}}"
                        Message="{Binding RegexError}"
                        IsClosable="False" />
        </Grid>

        <!-- 파일 목록 DataGrid -->
        <Border Grid.Row="3"
                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                AllowDrop="True"
                DragEnter="OnDragEnter"
                Drop="OnDrop">
            <DataGrid AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserResizeRows="False"
                      HeadersVisibility="Column"
                      GridLinesVisibility="Horizontal"
                      SelectionMode="Extended"
                      BorderThickness="0"
                      ItemsSource="{Binding Items}">
                <DataGrid.Columns>
                    <DataGridCheckBoxColumn Header="선택"
                                            Width="60"
                                            Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" />
                    <DataGridTextColumn Header="원본 파일명"
                                        Width="2*"
                                        Binding="{Binding OriginalName}"
                                        IsReadOnly="True" />
                    <DataGridTextColumn Header="변경 후 파일명"
                                        Width="2*"
                                        Binding="{Binding NewName}"
                                        IsReadOnly="True" />
                    <DataGridTextColumn Header="경로"
                                        Width="3*"
                                        Binding="{Binding OriginalPath}"
                                        IsReadOnly="True" />
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- 상태바 및 버튼 -->
        <Grid Grid.Row="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 진행률 표시 -->
            <Grid Grid.Row="0"
                  Margin="0,0,0,8"
                  Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <ProgressBar Grid.Column="0"
                             Height="4"
                             Value="{Binding Progress}"
                             Maximum="100"
                             VerticalAlignment="Center" />

                <TextBlock Grid.Column="1"
                           Text="{Binding StatusMessage}"
                           Margin="8,0,0,0"
                           VerticalAlignment="Center"
                           FontSize="12" />
            </Grid>

            <!-- 상태바 및 버튼 -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- 상태바 -->
                <StackPanel Grid.Column="0"
                            Orientation="Horizontal"
                            VerticalAlignment="Center">
                    <ui:SymbolIcon Symbol="DocumentBulletList24"
                                   FontSize="16"
                                   Margin="0,0,8,0" />
                    <TextBlock Margin="0,0,16,0">
                        <Run Text="선택: " />
                        <Run Text="{Binding SelectedCount, Mode=OneWay}" />
                        <Run Text="개" />
                    </TextBlock>
                    <TextBlock Margin="0,0,16,0">
                        <Run Text="변경: " />
                        <Run Text="{Binding RenamedCount, Mode=OneWay}" />
                        <Run Text="개" />
                    </TextBlock>
                    <TextBlock Foreground="{DynamicResource SystemFillColorCriticalBrush}">
                        <Run Text="충돌: " />
                        <Run Text="{Binding ConflictCount, Mode=OneWay}" />
                        <Run Text="개" />
                    </TextBlock>

                    <!-- 상태 메시지 -->
                    <TextBlock Text="{Binding StatusMessage}"
                               Margin="16,0,0,0"
                               FontStyle="Italic"
                               Visibility="{Binding StatusMessage, Converter={StaticResource NullToVisibilityConverter}}" />
                </StackPanel>

                <!-- 버튼 영역 -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal">
                    <ui:Button Content="실행 취소"
                               Margin="0,0,8,0"
                               Appearance="Secondary"
                               Icon="{ui:SymbolIcon ArrowUndo24}"
                               Command="{Binding UndoCommand}" />
                    <ui:Button Content="전체 지우기"
                               Margin="0,0,8,0"
                               Appearance="Secondary"
                               Command="{Binding ClearItemsCommand}" />
                    <ui:Button Content="이름 변경"
                               Appearance="Primary"
                               Icon="{ui:SymbolIcon DocumentEdit24}"
                               Command="{Binding RenameCommand}" />
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</ui:FluentWindow>
