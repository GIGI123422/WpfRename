<ui:FluentWindow x:Class="WpfRename.MainWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:local="clr-namespace:WpfRename"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 xmlns:converters="clr-namespace:WpfRename.Converters"
                 xmlns:res="clr-namespace:WpfRename.Resources"
                 mc:Ignorable="d"
                 Title="{x:Static res:Strings.AppTitle}"
                 Height="700"
                 Width="1000"
                 MinHeight="500"
                 MinWidth="800"
                 WindowStartupLocation="CenterScreen">

    <ui:FluentWindow.Resources>
        <converters:NullToBoolConverter x:Key="NullToBoolConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
    </ui:FluentWindow.Resources>

    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <!-- 왼쪽 컨트롤 패널 -->
            <ColumnDefinition Width="380" />
            <!-- 간격 -->
            <ColumnDefinition Width="16" />
            <!-- 오른쪽 데이터 그리드 -->
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- 왼쪽 컨트롤 패널 -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <!-- 프리셋 영역 -->
                <RowDefinition Height="Auto" />
                <!-- 간격 -->
                <RowDefinition Height="12" />
                <!-- 검색 -->
                <RowDefinition Height="Auto" />
                <!-- 간격 -->
                <RowDefinition Height="8" />
                <!-- 치환 -->
                <RowDefinition Height="Auto" />
                <!-- 간격 -->
                <RowDefinition Height="12" />
                <!-- 옵션 -->
                <RowDefinition Height="Auto" />
                <!-- 간격 -->
                <RowDefinition Height="12" />
                <!-- 정규식 도움말 -->
                <RowDefinition Height="Auto" />
                <!-- 간격 -->
                <RowDefinition Height="*" />
                <!-- 하단 아이콘 버튼 -->
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 프리셋 영역 -->
            <StackPanel Grid.Row="0">
                <TextBlock Text="{x:Static res:Strings.PresetLabel}"
                           FontWeight="SemiBold"
                           Margin="0,0,0,8" />
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="8" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="8" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <ComboBox Grid.Column="0"
                              ItemsSource="{Binding Presets}"
                              SelectedItem="{Binding SelectedPreset}"
                              DisplayMemberPath="Name">
                        <ComboBox.ItemContainerStyle>
                            <Style TargetType="ComboBoxItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            </Style>
                        </ComboBox.ItemContainerStyle>
                    </ComboBox>

                    <ui:Button Grid.Column="2"
                               Icon="{ui:SymbolIcon Save24}"
                               Appearance="Secondary"
                               ToolTip="{x:Static res:Strings.SavePresetButton}"
                               Click="OnSavePresetClick" />

                    <ui:Button Grid.Column="4"
                               Icon="{ui:SymbolIcon Delete24}"
                               Appearance="Secondary"
                               ToolTip="{x:Static res:Strings.DeletePresetButton}"
                               Command="{Binding DeletePresetCommand}"
                               CommandParameter="{Binding SelectedPreset}" />
                </Grid>
            </StackPanel>

            <!-- 검색 입력 -->
            <StackPanel Grid.Row="2">
                <TextBlock Text="{x:Static res:Strings.SearchLabel}"
                           FontWeight="SemiBold"
                           Margin="0,0,0,8" />
                <ui:TextBox PlaceholderText="{x:Static res:Strings.SearchPlaceholder}"
                            ClearButtonEnabled="True"
                            Text="{Binding SearchPattern, UpdateSourceTrigger=PropertyChanged}" />
            </StackPanel>

            <!-- 치환 입력 -->
            <StackPanel Grid.Row="4">
                <TextBlock Text="{x:Static res:Strings.ReplaceLabel}"
                           FontWeight="SemiBold"
                           Margin="0,0,0,8" />
                <ui:TextBox PlaceholderText="{x:Static res:Strings.ReplacePlaceholder}"
                            ClearButtonEnabled="True"
                            Text="{Binding ReplacePattern, UpdateSourceTrigger=PropertyChanged}">
                    <ui:TextBox.ToolTip>
                        <ToolTip>
                            <StackPanel MaxWidth="400">
                                <TextBlock FontWeight="Bold" Margin="0,0,0,8">사용 가능한 변수:</TextBlock>
                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,4">
                                    <Run FontWeight="SemiBold">열거형:</Run>
                                    <LineBreak />
                                    • ${count} - 순번 (001, 002, ...)
                                    <LineBreak />
                                    • ${count:start=10} - 시작 번호 지정
                                    <LineBreak />
                                    • ${count:step=5} - 증가값 지정
                                    <LineBreak />
                                    • ${count:digits=4} - 자릿수 지정
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap">
                                    <Run FontWeight="SemiBold">날짜/시간:</Run>
                                    <LineBreak />
                                    • ${now} - 현재 날짜/시간
                                    <LineBreak />
                                    • ${now:yyyy-MM-dd} - 형식 지정
                                    <LineBreak />
                                    • ${created} - 파일 생성일
                                    <LineBreak />
                                    • ${modified} - 파일 수정일
                                </TextBlock>
                            </StackPanel>
                        </ToolTip>
                    </ui:TextBox.ToolTip>
                </ui:TextBox>
            </StackPanel>

            <!-- 옵션 -->
            <StackPanel Grid.Row="6">
                <TextBlock Text="{x:Static res:Strings.OptionsLabel}"
                           FontWeight="SemiBold"
                           Margin="0,0,0,8" />
                <CheckBox Content="{x:Static res:Strings.UseRegexCheckBox}"
                          Margin="0,0,0,8"
                          IsChecked="{Binding UseRegex}" />
                <CheckBox Content="{x:Static res:Strings.CaseSensitiveCheckBox}"
                          Margin="0,0,0,8"
                          IsChecked="{Binding CaseSensitive}" />
                <TextBlock Text="{x:Static res:Strings.CaseTransformLabel}"
                           Margin="0,0,0,8" />
                <ComboBox SelectedIndex="{Binding CaseTransformIndex}">
                    <ComboBoxItem Content="{x:Static res:Strings.CaseNone}" />
                    <ComboBoxItem Content="{x:Static res:Strings.CaseLower}" />
                    <ComboBoxItem Content="{x:Static res:Strings.CaseUpper}" />
                    <ComboBoxItem Content="{x:Static res:Strings.CaseTitle}" />
                </ComboBox>

                <!-- 정규식 오류 메시지 -->
                <ui:InfoBar Margin="0,12,0,0"
                            Severity="Error"
                            IsOpen="{Binding RegexError, Converter={StaticResource NullToBoolConverter}}"
                            Message="{Binding RegexError}"
                            IsClosable="False" />
            </StackPanel>

            <!-- 정규식 도움말 (Expander) -->
            <Expander Grid.Row="8"
                      Header="정규식 도움말"
                      IsExpanded="False">
                <ScrollViewer MaxHeight="300"
                              VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="8">
                        <TextBlock FontWeight="SemiBold" Margin="0,0,0,4">기본 패턴:</TextBlock>
                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,8">
                            <Run>.</Run> - 임의의 한 문자<LineBreak />
                            <Run>*</Run> - 0회 이상 반복<LineBreak />
                            <Run>+</Run> - 1회 이상 반복<LineBreak />
                            <Run>?</Run> - 0회 또는 1회<LineBreak />
                            <Run>^</Run> - 문자열 시작<LineBreak />
                            <Run>$</Run> - 문자열 끝
                        </TextBlock>

                        <TextBlock FontWeight="SemiBold" Margin="0,0,0,4">문자 클래스:</TextBlock>
                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,8">
                            <Run>[abc]</Run> - a, b, c 중 하나<LineBreak />
                            <Run>[^abc]</Run> - a, b, c가 아닌 문자<LineBreak />
                            <Run>[a-z]</Run> - a부터 z까지<LineBreak />
                            <Run>\d</Run> - 숫자 [0-9]<LineBreak />
                            <Run>\w</Run> - 단어 문자 [a-zA-Z0-9_]<LineBreak />
                            <Run>\s</Run> - 공백 문자
                        </TextBlock>

                        <TextBlock FontWeight="SemiBold" Margin="0,0,0,4">그룹 및 치환:</TextBlock>
                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,8">
                            <Run>(pattern)</Run> - 캡처 그룹<LineBreak />
                            <Run>$1, $2...</Run> - 치환 시 그룹 참조<LineBreak />
                            <LineBreak />
                            <Run FontWeight="SemiBold">예시:</Run><LineBreak />
                            검색: <Run>(\d+)_(.+)</Run><LineBreak />
                            치환: <Run>$2_$1</Run><LineBreak />
                            123_file.txt → file_123.txt
                        </TextBlock>
                    </StackPanel>
                </ScrollViewer>
            </Expander>

            <!-- 하단 아이콘 버튼 (설정, 정보) -->
            <StackPanel Grid.Row="10"
                        Orientation="Horizontal"
                        HorizontalAlignment="Left"
                        Margin="0,8,0,0">
                <ui:Button Icon="{ui:SymbolIcon Settings24}"
                           Appearance="Secondary"
                           Margin="0,0,8,0"
                           ToolTip="설정"
                           IsEnabled="False" />
                <ui:Button Icon="{ui:SymbolIcon Info24}"
                           Appearance="Secondary"
                           ToolTip="{x:Static res:Strings.AboutTitle}"
                           Click="OnAboutClick" />
            </StackPanel>
        </Grid>

        <!-- 오른쪽 데이터 그리드 패널 -->
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <!-- 파일 목록 레이블 -->
                <RowDefinition Height="Auto" />
                <!-- 간격 -->
                <RowDefinition Height="8" />
                <!-- DataGrid -->
                <RowDefinition Height="*" />
                <!-- 간격 -->
                <RowDefinition Height="12" />
                <!-- 진행률 -->
                <RowDefinition Height="Auto" />
                <!-- 간격 -->
                <RowDefinition Height="8" />
                <!-- 상태바 및 버튼 -->
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- 파일 목록 레이블 -->
            <TextBlock Grid.Row="0"
                       Text="{x:Static res:Strings.FileListLabel}"
                       FontWeight="SemiBold" />

            <!-- 파일 목록 DataGrid -->
            <Border Grid.Row="2"
                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    AllowDrop="True"
                    DragEnter="OnDragEnter"
                    Drop="OnDrop">
                <DataGrid AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserResizeRows="False"
                          HeadersVisibility="Column"
                          GridLinesVisibility="Horizontal"
                          SelectionMode="Extended"
                          BorderThickness="0"
                          ItemsSource="{Binding Items}">
                    <DataGrid.Columns>
                        <DataGridCheckBoxColumn Header="☑"
                                                Width="60"
                                                Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" />
                        <DataGridTextColumn Header="{x:Static res:Strings.ColumnOriginalName}"
                                            Width="2*"
                                            Binding="{Binding OriginalName}"
                                            IsReadOnly="True" />
                        <DataGridTextColumn Header="{x:Static res:Strings.ColumnNewName}"
                                            Width="2*"
                                            Binding="{Binding NewName}"
                                            IsReadOnly="True" />
                        <DataGridTextColumn Header="📁"
                                            Width="3*"
                                            Binding="{Binding OriginalPath}"
                                            IsReadOnly="True" />
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!-- 진행률 표시 -->
            <Grid Grid.Row="4"
                  Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <ProgressBar Grid.Column="0"
                             Height="4"
                             Value="{Binding Progress}"
                             Maximum="100"
                             VerticalAlignment="Center" />

                <TextBlock Grid.Column="1"
                           Text="{Binding StatusMessage}"
                           Margin="8,0,0,0"
                           VerticalAlignment="Center"
                           FontSize="12" />
            </Grid>

            <!-- 상태바 및 버튼 -->
            <Grid Grid.Row="6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- 상태바 -->
                <StackPanel Grid.Column="0"
                            Orientation="Horizontal"
                            VerticalAlignment="Center">
                    <ui:SymbolIcon Symbol="DocumentBulletList24"
                                   FontSize="16"
                                   Margin="0,0,8,0" />
                    <TextBlock Margin="0,0,16,0">
                        <Run Text="선택: " />
                        <Run Text="{Binding SelectedCount, Mode=OneWay}" />
                        <Run Text="개" />
                    </TextBlock>
                    <TextBlock Margin="0,0,16,0">
                        <Run Text="변경: " />
                        <Run Text="{Binding RenamedCount, Mode=OneWay}" />
                        <Run Text="개" />
                    </TextBlock>
                    <TextBlock Foreground="{DynamicResource SystemFillColorCriticalBrush}">
                        <Run Text="충돌: " />
                        <Run Text="{Binding ConflictCount, Mode=OneWay}" />
                        <Run Text="개" />
                    </TextBlock>

                    <!-- 상태 메시지 -->
                    <TextBlock Text="{Binding StatusMessage}"
                               Margin="16,0,0,0"
                               FontStyle="Italic"
                               Visibility="{Binding StatusMessage, Converter={StaticResource NullToVisibilityConverter}}" />
                </StackPanel>

                <!-- 버튼 영역 -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal">
                    <ui:Button Content="{x:Static res:Strings.UndoButton}"
                               Margin="0,0,8,0"
                               Appearance="Secondary"
                               Icon="{ui:SymbolIcon ArrowUndo24}"
                               Command="{Binding UndoCommand}" />
                    <ui:Button Content="{x:Static res:Strings.ClearButton}"
                               Margin="0,0,8,0"
                               Appearance="Secondary"
                               Command="{Binding ClearItemsCommand}" />
                    <ui:Button Content="{x:Static res:Strings.RenameButton}"
                               Appearance="Primary"
                               Icon="{ui:SymbolIcon DocumentEdit24}"
                               Command="{Binding RenameCommand}" />
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</ui:FluentWindow>
